/*
Deployment script for SupplierDB

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "SupplierDB"
:setvar DefaultFilePrefix "SupplierDB"
:setvar DefaultDataPath "/var/opt/mssql/data/"
:setvar DefaultLogPath "/var/opt/mssql/data/"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Altering Procedure [dbo].[sprocCliente_UpdateValorLimite]...';


GO
ALTER PROCEDURE [dbo].[sprocCliente_UpdateValorLimite]
    @Id int,
    @NovoValorLimite NUMERIC
AS
BEGIN
    IF EXISTS (SELECT 1 FROM dbo.Cliente WHERE Id = @Id)
        BEGIN
            UPDATE dbo.Cliente
            SET ValorLimite = @NovoValorLimite
            WHERE Id = @Id;
            SELECT 'Valor Limite atualizado com sucesso.' AS Mensagem;
        END
    ELSE
        BEGIN
            SELECT 'Erro: Cliente não encontrado.' AS Mensagem;
        END
END;
GO
BEGIN
    IF NOT EXISTS (SELECT 1 FROM [dbo].[Usuario])
    BEGIN
        INSERT INTO [dbo].[Usuario] ([Email], [Senha])
        VALUES
            ('Luis@example.com', 'senha123'),
            ('Claudio@example.com', 'senha456'),
            ('Kaique@example.com', 'senha789');
    END

    IF NOT EXISTS (SELECT 1 FROM [dbo].[Cliente])
    BEGIN
        INSERT INTO [dbo].[Cliente] ([Nome], [Cpf], [ValorLimite])
        VALUES
            ('Michel', '000.000.000-74', 1000.00),
            ('Juliana', '111.111.111-11', 1500.00),
            ('Bruno', '222.222.222-22', 2000.00);
    END
END
GO

GO
PRINT N'Update complete.';


GO
